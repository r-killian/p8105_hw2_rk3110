---
title: "Homework 2"
author: Rose Killian (rk3110)
output: github_document
---

Loading the libraries needed for this homework.

```{r, message = FALSE}
library(tidyverse)
library(readxl)
```


# Problem 1

First we need to import data from the Mr. Trash Wheel excel file. Looking at it, there is banner on line one that has a drawing of Mr. Wheel. While cute, we should exclude that line from the import. Since some cells of the sheet also contain notes, it is easiest to just define the area with the data we want when importing and then specify to drop rows without dumpster specific information. We will also clean the names and round the number of sports balls per dumpster to the nearest integer. 

```{r}
trash_df = 
  read_excel("data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx", 
      sheet = "Mr. Trash Wheel", 
      range = "A2:N574"
) %>% 
  janitor::clean_names() %>% 
  drop_na() %>% 
  mutate(sports_balls = round(sports_balls))
```

Next we will import and clean the precipitation data for 2018 and 2019. We will also combine the datasets and convert `month` to a character variable. I also reordered the columns so year comes first.

```{r}
prcp_2018 = 
  read_excel("data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
      sheet = "2018 Precipitation",
      skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year = 2018)

prcp_2019 = 
  read_excel("data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
      sheet = "2019 Precipitation",
      skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year = 2019)

prcp_df = 
  bind_rows(prcp_2018, prcp_2019) %>% 
  mutate(month = month.name[month]) %>% 
  relocate(year)
```

We end up with two data sets. The `trash_df` data frame contains `r nrow(trash_df)` observations of dumpsters filled by Mr. Trash Wheel between `r min(pull(trash_df, year))` and `r max(pull(trash_df, year))`. It includes the weight in tons of each dumpster and the amount of various types of trash such as plastic bottles and cigarette butts. The `prcp_df` data frame describes the total precipitation in inches across `r nrow(prcp_df)` months from January 2018 to December 2019. The total precipitation in 2018 was `r sum(pull(prcp_2018, total))` inches. The median number of sports balls in a dumpster in 2019 was `r trash_df_2019 = filter(trash_df, year == 2019)``r  median(pull(trash_df_2019, sports_balls))` balls.


# Problem 2

### Cleaning pols-month.csv
Now we take a look at the FiveThirtyEight data. Let's import the first csv, clean names, separate the date variable into its components, and replace the month number with its name.We will also create a new variable `president` with values `gop` or `dem` and remove the variables `prez_dem`, `prez_gop`, and `day`.

```{r}
pols_df = 
  read_csv("data/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, into = c("month", "day", "year"), sep = "/", convert = TRUE) %>% 
  mutate(
    month = month.name[month],
    president = recode(prez_dem, `0` = "gop", `1` = "dem")) %>% 
  select(-day, -prez_dem, -prez_gop) %>% 
  relocate(year)
```

### Cleaning snp.csv
Next we move on to the snp.csv. We can reuse the separate code from part one here to separate the date components.

```{r}
snp_df = 
  read_csv("data/snp.csv") %>% 
  janitor::clean_names() %>% 
  separate(date, into = c("month", "day", "year"), sep = "/", convert = TRUE) %>% 
  mutate(month = month.name[month]) %>%
  relocate(year, month)
```

### Cleaning unemployment.csv
Moving on to unemployment.csv. To match with the other two data sets, we need the columns to be year, month, and unemployment.The months are listed in the .csv as their three letter abbreviations so we need to fix that as well. 

```{r}
unemployment_df = 
  read_csv("data/unemployment.csv") %>% 
  janitor::clean_names() %>% 
  rename(January = jan, February = feb, March = mar, April = apr, May = may, June = jun, July = jul, August = aug, September = sep, October = oct, November = nov, December = dec) %>% 
  pivot_longer(
    January:December,
    names_to = "month",
    values_to = "percent_unemployed"
  ) %>%
  relocate(year, month)
```


### Joining data frames and description

Now we join `pols_df` and `snp_df` and then join `unemployment_df` to the result

```{r}
joined_df = 
  left_join(pols_df, snp_df, by = c("year", "month")) %>% 
  left_join(unemployment_df, by = c("year", "month"))
```

Our first data set, "pols-month," described the number of national politicians who are democrats or republicans between `r min(pull(pols_df, year))` and `r max(pull(pols_df, year))`. Our second data set, "snp," contained date information and an indicator of stock market performance. Our third data set, "unemployment," detailed the monthly percentage of unemployment between `r min(pull(unemployment_df, year))` and `r max(pull(unemployment_df, year))`. Our new data set contains `r nrow(joined_df)` observations of 12 variables, including, year, month, political party of the president(`president`), number of democratic and republican politicians who are governors (`gov_gop` and `gov_dem`), senate members (`sen_gop` and `sen_dem`), or representatives (`rep_gop` and `rep_dem`). It also includes the closing values of the S&P stock index (`close`) and monthly unemployment as a percentage (`percent_unemployed`). The information in this data set ranges from years `r min(pull(joined_df, year))` to `r max(pull(joined_df, year))`.

# Problem 3

Importing "Popular_Baby_Names.csv" and cleaning the data. Some entries in year 2011 are duplicated and need to be removed. The ethnicity coding in 2012 truncated the ethnicity in some entries. We will also change all the entries to lowercase for consistency.

```{r}
baby_df = 
  read_csv("data/Popular_Baby_Names.csv") %>% 
  janitor::clean_names() %>% 
  mutate(
    ethnicity = replace(ethnicity, ethnicity == "ASIAN AND PACI", "ASIAN AND PACIFIC ISLANDER"),
    ethnicity = replace(ethnicity, ethnicity == "WHITE NON HISP", "WHITE NON HISPANIC"),
    ethnicity = replace(ethnicity, ethnicity == "BLACK NON HISP", "BLACK NON HISPANIC")
    ) %>% 
  mutate(
    childs_first_name = str_to_lower(childs_first_name),
    ethnicity = str_to_lower(ethnicity),
    gender = str_to_lower(gender)
    ) %>% 
  distinct(year_of_birth, gender, ethnicity, childs_first_name, .keep_all = T)
```

Next we will make a table showing the yearly popularity rank of the name "Olivia" by ethnicity.

```{r}
baby_df %>% 
  filter(childs_first_name == "olivia", gender == "female") %>% 
  select(year_of_birth, ethnicity, rank) %>% 
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "rank"
  ) %>% 
    knitr::kable(caption = "Popularity of the Name Olivia for Female Babies")
```

Looking at male children, let's make a similar table with the name *Need to figure out popular boys name*

```{r}
baby_df %>% 
  filter(gender == "male", rank == 1) %>% 
  view()
```

Look's like "Jayden" is often ranked #1 for boys among a number of ethnic groups so we will go with that.

```{r}
baby_df %>% 
  filter(childs_first_name == "jayden", gender == "male") %>% 
  select(year_of_birth, ethnicity, rank) %>% 
  pivot_wider(
    names_from = "year_of_birth",
    values_from = "rank"
  ) %>% 
    knitr::kable(caption = "Popularity of the Name Jayden for Male Babies")
```

"Jayden" is not very popular among the White non-Hispanic group. White non-Hispanic people favor "Joseph" or "David" but no other group uses those names frequently.

Finally, looking at male, white non-Hispanic children born in 2016 let's make a scatter plot comparing the number of children with a name to its rank. 

```{r}
baby_df %>% 
  filter(gender == "male", year_of_birth == 2016, ethnicity == "white non hispanic") %>% 
  ggplot(aes(x = rank, y = count)) +
  geom_point()
```

